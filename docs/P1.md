---
toc: true
sql:
    spotify: ./data/spotify-2023-limpo.csv
---

<style>
    body, div, p, li, ol { max-width: none; }
</style>

# Pergunta 1
Existe alguma característica que faz uma música ter mais chance de se tornar popular?

```sql id = histograma
SELECT * FROM spotify
```

```sql id = pizza_2 
WITH TotalCount AS (
    SELECT COUNT(*) as total
    FROM spotify
)
SELECT mode, 
       COUNT(*) as count, 
       (COUNT(*) * 100.0 / (SELECT total FROM TotalCount)) as percentage
FROM spotify
GROUP BY mode
```
## Visualizações

<div class="grid grid-cols-2">
    <div id="ex01" class="card grid-colspan-2">
        <h2 class="title">Características mais presentes</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex01(divWidth - 180)) }
        </div>
    </div>
    <div id="ex02" class="card grid-colspan-2">
        <h2>Características menos presentes</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex02(divWidth - 245)) }
        </div>
    </div>
    <div id="ex03" class="card grid-colspan-2">
        <h2>divisão por escalas</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex03(divWidth - 70)) }
        </div>
    </div>
</div>


```js
const divWidth = Generators.width(document.querySelector("#ex01"));

```

```js
import * as vega from "npm:vega";
import * as vegaLite from "npm:vega-lite";
import * as vegaLiteApi from "npm:vega-lite-api";

const vl = vegaLiteApi.register(vega, vegaLite);

function ex01(divWidth) {
    return {
        spec: {
            data: {
                values: histograma
            },
            "hconcat":[
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "danceability_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    },
                                    "scale": {"domain": [0,100]}
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "valence_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "energy_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
            ]
        }
    }
}


function ex02(divWidth) {
    return {
        spec: {
            data: {
                values: histograma
            },
            "hconcat":[
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "acousticness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    },
                                    "scale": {"domain": [0,100]}
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "instrumentalness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "liveness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "speechiness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
            ]
        }
    }
}
function ex03(divWidth) {
    return {
            spec: {
                width: divWidth,
                height: 440,
                data: {
                    values: pizza_2
                },
                "transform":[
                    {
                        "calculate": "format(datum.percentage, '.2f') + '%'", "as": "percentageLabel"
                    }
                ],
                "mark": {
                    "type": "arc",
                },
                "encoding": {
                    "theta": {"field": "count", "type": "quantitative", "stack": "normalize"},
                    "color": {"field": "mode", "type": "nominal"}
                },
                "layer": [
                    {
                    "mark": {"type": "arc", "outerRadius": 180}
                    },
                    {
                    "mark": {"type": "text", "radius": 120},
                    "encoding": {
                        "text": {"field": "percentageLabel", "type": "nominal"},
                        "color": {"value": "black"}
                    }
                    }
                ],
            }
        }
    }
```


## Análise
1. Com base na análise dos histogramas, pode-se perceber que as características danceability e energy possuem valores expressivos para a maioria das músicas presente no conjunto de dados.

2. Por outro lado, as características acousticness, instrumentalness, liveness e speechiness possuem valores quase que insignificantes.

3. Logo, podemos inferir que para uma música se tornar popular ela deve possuir um percentual de danceability e energy alto, além disso, deve possuir um percentual de acousticness, instrumentalness, liveness e speechiness baixo. Por outro lado, podemos perceber que o percentual de valence é bem distribuido para todas as músicas, de modo que não é um fator relevante para sua popularidade.
   
4. Já para o gráfico de pizza, é perceptível que o percentual de major e minor são de quase 50/50, de modo que a escala presente na música não parece interferir na sua popularidade.

## Design utilizados
1. As duas primeiras visualizações comparam as características de danceabilidade, valência e energia com a quantidade de músicas. Isso possibilita observar quais faixas de valores dessas características estão mais associadas a músicas populares. Utilizamos histogramas para visualizar a distribuição das categorias, para identificar padrões nos indíces. Separamos em duas visualizações para deixar claro o grupo de caracteristicas que afetam positivamente e o que afetam negativamente. Como canal visual utilizamos barras para mostrar a distribuição, no eixo X representamos a porcentagem da caracteristica específica, que é escalada com binning para agrupar valores em intervalos. E por fim o eixo Y representa a contagem das músicas. Optamos também por limitar o domain do eixo y em 280 e o início do eixo x no 0, para que todos os gráficos estivessem na mesma escala.

2. Utilizamos um gráfico de pizza para visualizar a proporção de cada modo, dentro do conjunto de dados. Nos canais visuais utilizamos cores para diferenciar as categorias, utilizando uma escala nominal, optamos por adicionar uma legenda para mostrar o que representa cada cor, além de um texto para mostrar o percentual de cada fatia. Utilizamos também como marcadores, arcos para criar os segmentos do gráfico de pizza, juntamente com o theta que representa a quantidade de músicas em cada modo, escalado para determinar o tamanho de cada segmento do arco.