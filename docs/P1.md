---
toc: true
sql:
    spotify: ./data/spotify-2023-limpo.csv
---

<style>
    body, div, p, li, ol { max-width: none; }
</style>

# Pergunta 1
Existe alguma característica que faz uma música ter mais chance de se tornar popular?

```sql id = histograma
SELECT * FROM spotify
```

```sql id = pizza_2 
WITH TotalCount AS (
    SELECT COUNT(*) as total
    FROM spotify
)
SELECT mode, 
       COUNT(*) as count, 
       (COUNT(*) * 100.0 / (SELECT total FROM TotalCount)) as percentage
FROM spotify
GROUP BY mode
```
## Visualizações

<div class="grid grid-cols-2">
    <div id="ex01" class="card grid-colspan-2">
        <h2 class="title">Características mais presentes</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex01(divWidth - 180)) }
        </div>
    </div>
    <div id="ex02" class="card grid-colspan-2">
        <h2>Características menos presentes</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex02(divWidth - 245)) }
        </div>
    </div>
    <div id="ex03" class="card grid-colspan-2">
        <h2>divisão por escalas</h2>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex03(divWidth - 70)) }
        </div>
    </div>
</div>


```js
const divWidth = Generators.width(document.querySelector("#ex01"));

```

```js
import * as vega from "npm:vega";
import * as vegaLite from "npm:vega-lite";
import * as vegaLiteApi from "npm:vega-lite-api";

const vl = vegaLiteApi.register(vega, vegaLite);

function ex01(divWidth) {
    return {
        spec: {
            data: {
                values: histograma
            },
            "hconcat":[
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "danceability_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    },
                                    "scale": {"domain": [0,100]}
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "valence_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 3,
                            height: 400,
                            "mark":{
                                "type": "bar",
                            },
                            "encoding":{
                                "x":{
                                    "field": "energy_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
            ]
        }
    }
}


function ex02(divWidth) {
    return {
        spec: {
            data: {
                values: histograma
            },
            "hconcat":[
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "acousticness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    },
                                    "scale": {"domain": [0,100]}
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "instrumentalness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "liveness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
                {
                    "layer":[
                        {
                            width: divWidth / 4,
                            height: 400,
                            "mark":{
                                "type": "bar",
                                "clip": true
                            },
                            "encoding":{
                                "x":{
                                    "field": "speechiness_percentage",
                                    "type": "quantitative",
                                    "bin": {
                                        "maxbins": 10
                                    }
                                },
                                "y": {
                                    "field": "streams",
                                    "type": "quantitative",
                                    "aggregate": "count",
                                    "scale": {"domain": [0,280]}
                                }
                            }
                        }
                    ]
                },
            ]
        }
    }
}
function ex03(divWidth) {
    return {
            spec: {
                width: divWidth,
                height: 440,
                data: {
                    values: pizza_2
                },
                "transform":[
                    {
                        "calculate": "format(datum.percentage, '.2f') + '%'", "as": "percentageLabel"
                    }
                ],
                "mark": {
                    "type": "arc",
                },
                "encoding": {
                    "theta": {"field": "count", "type": "quantitative", "stack": "normalize"},
                    "color": {"field": "mode", "type": "nominal"}
                },
                "layer": [
                    {
                    "mark": {"type": "arc", "outerRadius": 180}
                    },
                    {
                    "mark": {"type": "text", "radius": 120},
                    "encoding": {
                        "text": {"field": "percentageLabel", "type": "nominal"},
                        "color": {"value": "black"}
                    }
                    }
                ],
            }
        }
    }
```


## Análise
1. Analisando os dados exibidos acima, nota-se que o Spotify possui a maior parte das músicas adicionadas em playlists, com aproximadamente 92% do total, sendo um número muito expressivo. O Deezer possui 7% do total, enquanto o Apple Music, 1%.

2. Já em relação a quantidade de Charts por Plataforma, o Apple Music e o Shazam são as escolhas mais populares, pois detem as maiores fatias, 42% e 46% respectivamente, enquanto o Spotify e Deezer tem uma fatia pequena, de 10% e 2%.

3. A preferência dos usuários por adicionar músicas em playlists parece ser fortemente inclinada para o Spotify, o que pode indicar uma maior base de usuários ou recursos mais atraentes para a criação e compartilhamento de playlists.
4. No entanto, quando se trata da criação de charts, a situação é um pouco diferente, com o Apple Music e o Shazam tendo uma participação mais significativa. Isso pode refletir diferenças na forma como as plataformas promovem e destacam músicas populares.

## Design utilizados
1. Para ambas as visualizações, foi utilizado um gráfico de pizza, onde o tamanho das fatias representa a proporção das métricas analisadas (quantidade de músicas adicionadas em playlists e quantidade de charts) para cada plataforma.
2. O canal visual de cor foi utilizado para distinguir as diferentes plataformas, facilitando a compreensão dos dados.
3. Não existe viés nos designs escolhidos, as visualizações são diretas e fáceis de interpretar, com diferenças de proporções bem claras e visíveis.